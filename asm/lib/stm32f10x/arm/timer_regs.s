    INCLUDE stm32.s
    INCLUDE irq.s    
    INCLUDE rcc_regs.s

TIM1 EQU 0
TIM2 EQU 1 
TIM3 EQU 2 

    IF :LNOT: :DEF:STM32F10X_LD && :LNOT: :DEF:STM32F10X_LD_VL
TIM4 EQU 3 
    ENDIF 
        
        
    IF :DEF:STM32F4 || :DEF:STM32F2 || :DEF:STM32F10X_HD ||\
       :DEF:STM32F10X_HD_VL || :DEF:STM32F10X_XL || :DEF:STM32F10X_CL        
TIM5 EQU 4 
    ENDIF
    

    IF :DEF:STM32F10X_LD_VL || :DEF:STM32F10X_MD_VL || :DEF:STM32F10X_HD_VL
        GBLS IRQn_TIM1_UP IRQn_TIM1_UP_TIM16
    ELIF :DEF:STM32F10X_XL || :DEF:STM32F4 || :DEF:STM32F2
        GBLS IRQn_TIM1_UP IRQn_TIM1_UP_TIM10
    ENDIF


    IF (:DEF:STM32F10X_XL || :DEF:STM32F10X_HD || :DEF:STM32F4 || :DEF:STM32F2) \
        && :LNOT: :DEF:STM32F401xC  && :LNOT::DEF:STM32F401xE && :LNOT::DEF:STM32F401xx \
        && :LNOT::DEF:STM32F411xE

        if :DEF:STM32F10X_XL || :DEF:STM32F2 || :DEF:STM32F4
            GBLS IRQn_TIM8_UP IRQn_TIM8_UP_TIM13
        endif

    IF (:DEF:STM32F4 || :DEF:STM32F2 || :DEF:VALUE_LINE  \
        || :DEF:STM32F10X_HD  || :DEF:STM32F10X_XL || :DEF:STM32F10X_CL) \
        && :LNOT: :DEF:STM32F401xC && :LNOT: :DEF:STM32F401xE && :LNOT: :DEF:STM32F401xx \
        && :LNOT: :DEF:STM32F411xE



    IF :DEF:VALUE_LINE || :DEF:STM32F2 || :DEF:STM32F4
        GBLS IRQn_TIM6 IRQn_TIM6_DAC
    ENDIF


TIM6 EQU 5 
TIM7 EQU 6
    
    ENDIF

TIM8 EQU 7        
        
    ENDIF    



    IF :DEF:STM32F2 || :DEF:STM32F4 || :DEF:STM32F10X_XL
TIM9  EQU 8        
TIM10 EQU 9
TIM11 EQU 10
    ENDIF


    IF (:DEF:STM32F10X_HD_VL || :DEF:STM32F10X_XL || :DEF:STM32F2 || :DEF:STM32F4) \
        && :LNOT: :DEF:STM32F401xC  && :LNOT: :DEF:STM32F401xE && :LNOT: :DEF:STM32F401xx 
        && :LNOT: :DEF:STM32F411xE
        
        
TIM12 EQU 11        
        
    ENDIF    


    IF (:DEF:STM32F2 || :DEF:STM32F4 || :DEF:STM32F10X_HD_VL || :DEF:STM32F10X_XL) \
        && :LNOT::DEF:STM32F401xC  && :LNOT::DEF:STM32F401xE && :LNOT::DEF:STM32F401xx \
        && :LNOT::DEF:STM32F411xE

        IF :DEF:STM32F10X_XL || :DEF:STM32F2 || :DEF:STM32F4
                GBLS IRQn_TIM13  IRQn_TIM8_UP_TIM13
                GBLS IRQn_TIM14  IRQn_TIM8_TRG_COM_TIM14
        ENDIF

TIM13 EQU 12
TIM14 EQU 13

    ENDIF

    IF :DEF:VALUE_LINE
TIM15 EQU 14
TIM16 EQU 15
TIM17 EQU 16
    ENDIF



TIM2_BASE  EQU  0x40000000  ;APB1
TIM3_BASE  EQU  0x40000400  ;APB1
TIM6_BASE  EQU  0x40001000  ;APB1
TIM7_BASE  EQU  0x40001400  ;APB1

    IF :DEF:STM32F1 || :DEF:STM32F2 || :DEF:STM32F4

TIM4_BASE  EQU  0x40000800  ;APB1
TIM5_BASE  EQU  0x40000C00  ;APB1
TIM12_BASE  EQU 0x40001800  ;APB1
TIM13_BASE  EQU 0x40001C00  ;APB1
TIM14_BASE  EQU 0x40002000  ;APB1

        IF :DEF:STM32F1 
TIM1_BASE  EQU   0x40012C00  ;APB2
TIM8_BASE  EQU   0x40013400  ;APB2
TIM9_BASE  EQU   0x40014C00  ;APB2
TIM10_BASE  EQU  0x40015000  ;APB2
TIM11_BASE  EQU  0x40015400  ;APB2
        ELSE 
TIM1_BASE  EQU   0x40010000   ;APB2
TIM8_BASE  EQU   0x40010000   ;APB2
TIM9_BASE  EQU   0x40014000  ;APB2
TIM10_BASE  EQU  0x40014400  ;APB2
TIM11_BASE  EQU  0x40014800  ;APB2
        ENDIF


        IF :DEF:STM32F1
TIM15_BASE  EQU  0x40014000  ;APB2
TIM16_BASE  EQU  0x40014400  ;APB2
TIM17_BASE  EQU  0x40014800  ;APB2
        ENDIF

    ELIF :DEF:STM32L0

TIM21_BASE  EQU  0x40010800 ;APB2
TIM22_BASE  EQU  0x40011400 ;APB2

    ELSE

    ASSERT {FALSE}

    ENDIF


TIM_CR1_OFFSET    EQU   0x00
TIM_CR2_OFFSET    EQU   0x04
TIM_SMCR_OFFSET   EQU   0x08
TIM_DIER_OFFSET   EQU   0x0c
TIM_SR_OFFSET     EQU   0x10
TIM_EGR_OFFSET    EQU   0x14
TIM_CCMR1_OFFSET  EQU   0x18
TIM_CCMR2_OFFSET  EQU   0x1c
TIM_CCER_OFFSET   EQU   0x20
TIM_CNT_OFFSET    EQU   0x24
TIM_PSC_OFFSET    EQU   0x28
TIM_ARR_OFFSET    EQU   0x2c
TIM_RCR_OFFSET    EQU   0x30
TIM_CCR1_OFFSET   EQU   0x34
TIM_CCR2_OFFSET   EQU   0x38
TIM_CCR3_OFFSET   EQU   0x3c
TIM_CCR4_OFFSET   EQU   0x40
TIM_DCR_OFFSET    EQU   0x48
TIM_BDTR_OFFSET   EQU   0x44
TIM_DMAR_OFFSET   EQU   0x4c



TIM_CR1_CEN EQU (1<<0) ;counter enable
TIM_CR1_UDIS EQU (1<<1) ;update disable: set/cleared by software
                            ;0:Update event enabled. 1: UEV disabled
TIM_CR1_URS  EQU (1<<2) ;set/cleared by sw to select the UEV sources
;0: any of these generated an update interrupt: counter overflow/underflow, setting the UG bit, 
;1: only counter overflow/underflow 

TIM_CR1_OPM  EQU (1<<3) ;one pulse mode
;0: counter is not stopped at update event 
;1: counter stops counting at the next update event and CEN is cleared
TIM_CR1_DIR  EQU (1<<4)  ;direction: 0: upcounter, 1: downcounter
TIM_CR1_CMS_EDGE_ALIGNED EQU (0<<5)
TIM_CR1_CMS_CENTER_ALIGNED_DOWN EQU (1<<5)
TIM_CR1_CMS_CENTER_ALIGNED_UP EQU (2<<5)
TIM_CR1_CMS_CENTER_ALIGNED_UP_DOWN EQU (3<<5)
TIM_CR1_CMS_CLEARMASK       EQU (3<<5)
TIM_CR1_ARPE  EQU (1<<7)  ;auto preload enable, 0: TIMx_ARR is not buffered, 1: buffered
TIM_CR1_CKD_CKINT EQU (0<<8)
TIM_CR1_CKD_CKINT2 EQU (1<<8)
TIM_CR1_CKD_CKINT4 EQU (2<<8)
TIM_CR1_CKD_CLEARMASK EQU (3<<8)

TIM_CR2_CCDS                EQU (1<<3)

TIM_CR2_MMS_RESET           EQU (0<<4)
TIM_CR2_MMS_ENABLE          EQU (1<<4)
TIM_CR2_MMS_UPDATE          EQU (2<<4)
TIM_CR2_MMS_COMPARE_PULSE   EQU (3<<4)
TIM_CR2_MMS_COMPARE_OC1REF  EQU (4<<4)
TIM_CR2_MMS_COMPARE_OC2REF  EQU (5<<4)
TIM_CR2_MMS_COMPARE_OC3REF  EQU (6<<4)
TIM_CR2_MMS_COMPARE_OC4REF  EQU (7<<4)
TIM_CR2_MMS_CLEARMASK       EQU (7<<4)
TIM_CR2_TI1S                EQU (1<<7)  ;TIM1/8 2/3/4/5, 100x: TIM15/16/17


TIM_DIER_UIE    EQU (1<<0) ;update interrupt enable
TIM_DIER_CC1IE  EQU (1<<1) ;Capture/compare int enable
TIM_DIER_CC2IE  EQU (1<<2)
TIM_DIER_CC3IE  EQU (1<<3)
TIM_DIER_CC4IE  EQU (1<<4)
TIM_DIER_TIE    EQU (1<<6) ;Trigger interrupt enable 
TIM_DIER_UDE    EQU (1<<8) ;Update DMA request enable 
TIM_DIER_CC1DE  EQU (1<<9) ;Capture/compare DMA enable
TIM_DIER_CC2DE  EQU (1<<10)
TIM_DIER_CC3DE  EQU (1<<11)
TIM_DIER_CC4DE  EQU (1<<12)
TIM_DIER_TDE    EQU (1<<14) ;Trigger DMA request enable


TIM_SR_UIF    EQU (1<<0) ;update interrupt flag
TIM_SR_CC1IF  EQU (1<<1) ;Capture/compare int
TIM_SR_CC2IF  EQU (1<<2) ;
TIM_SR_CC3IF  EQU (1<<3) ;
TIM_SR_CC4IF  EQU (1<<4) ;
TIM_SR_TIF    EQU (1<<6) ;
TIM_SR_CC1OF  EQU (1<<9) ;overcapture flag
TIM_SR_CC2OF  EQU (1<<10)
TIM_SR_CC3OF  EQU (1<<11)
TIM_SR_CC4OF  EQU (1<<12)


TIM_CCMR_CC1_BITPOS         EQU 0
TIM_CCMR_IC1PSC_BITPOS      EQU 2
TIM_CCMR_IC1F_BITPOS        EQU 4
TIM_CCMR_OC1M_BITPOS        EQU 4

;0-1
TIM_CCMR1_CC1S_OUT           EQU  0
TIM_CCMR1_CC1S_IN_TI1        EQU  1
TIM_CCMR1_CC1S_IN_TI2        EQU  2
TIM_CCMR1_CC1S_IN_TRC        EQU  3
TIM_CCMR1_CC1S_CLEARMASK     EQU  3

;2-3 out
TIM_CCMR1_OC1FE              EQU (1<<2) ;fast enable
TIM_CCMR1_OC1PE              EQU (1<<3) ;preload enable

;2-3 input capture prescaler
TIM_CCMR1_IC1PSC_DIV1             EQU (0<<2)
TIM_CCMR1_IC1PSC_DIV2             EQU (1<<2)
TIM_CCMR1_IC1PSC_DIV4             EQU (2<<2)
TIM_CCMR1_IC1PSC_DIV8             EQU (3<<2)
TIM_CCMR1_IC1PSC_CLEARMASK        EQU (3<<2)

;4-6 output
TIM_CCMR1_OC1M_FROZEN             EQU (0<<4)
TIM_CCMR1_OC1M_ACTIVE_ON_MATCH    EQU (1<<4)
TIM_CCMR1_OC1M_INACTIVE_ON_MATCH  EQU (2<<4)
TIM_CCMR1_OC1M_TOGGLE             EQU (3<<4)
TIM_CCMR1_OC1M_FORCE_LOW          EQU (4<<4)
TIM_CCMR1_OC1M_FORCE_HIGH         EQU (5<<4)
TIM_CCMR1_OC1M_PWM1               EQU (6<<4)
TIM_CCMR1_OC1M_PWM2               EQU (7<<4)
TIM_CCMR1_OC1M_CLEARMASK          EQU (7<<4)
;7  out
TIM_CCMR1_OC1CE                   EQU (1<<7)

;4-7 input capture filter
TIM_CCMR1_IC1F_FDTS        EQU (0<<4) 
TIM_CCMR1_IC1F_FCK_INT_2   EQU (1<<4)
TIM_CCMR1_IC1F_FCK_INT_4   EQU (2<<4)
TIM_CCMR1_IC1F_FCK_INT_8   EQU (3<<4)
TIM_CCMR1_IC1F_FDTS_2_6    EQU (4<<4)
TIM_CCMR1_IC1F_FDTS_2_8    EQU (5<<4)
TIM_CCMR1_IC1F_FDTS_4_6    EQU (6<<4)
TIM_CCMR1_IC1F_FDTS_4_8    EQU (7<<4)
TIM_CCMR1_IC1F_FDTS_8_6    EQU (8<<4)
TIM_CCMR1_IC1F_FDTS_8_8    EQU (9<<4)
TIM_CCMR1_IC1F_FDTS_16_5   EQU (10<<4)
TIM_CCMR1_IC1F_FDTS_16_6   EQU (11<<4)
TIM_CCMR1_IC1F_FDTS_16_8   EQU (12<<4)
TIM_CCMR1_IC1F_FDTS_32_5   EQU (13<<4)
TIM_CCMR1_IC1F_FDTS_32_6   EQU (14<<4)
TIM_CCMR1_IC1F_FDTS_32_8   EQU (15<<4)
TIM_CCMR1_IC1F_CLEARMASK   EQU (15<<4)
;8-9
TIM_CCMR1_CC2S_OUT             EQU (0<<8)               
TIM_CCMR1_CC2S_IN_TI2          EQU (1<<8)        
TIM_CCMR1_CC2S_IN_TI1          EQU (2<<8)        
TIM_CCMR1_CC2S_IN_TRC          EQU (3<<8)   
TIM_CCMR1_CC2S_CLEARMASK       EQU (3<<8)
;10-11 out
TIM_CCMR1_OC2FE                   EQU (1<<10)                 
TIM_CCMR1_OC2PE                   EQU (1<<11)                 
;10-11 input capture prescaler
TIM_CCMR1_IC2PSC_DIV1             EQU (0<<10)
TIM_CCMR1_IC2PSC_DIV2             EQU (1<<10)
TIM_CCMR1_IC2PSC_DIV4             EQU (2<<10)
TIM_CCMR1_IC2PSC_DIV8             EQU (3<<10)

;12-14 output
TIM_CCMR1_OC2M_FROZEN             EQU (0<<12)
TIM_CCMR1_OC2M_ACTIVE_ON_MATCH    EQU (1<<12)
TIM_CCMR1_OC2M_INACTIVE_ON_MATCH  EQU (2<<12)
TIM_CCMR1_OC2M_TOGGLE             EQU (3<<12)
TIM_CCMR1_OC2M_FORCE_LOW          EQU (4<<12)
TIM_CCMR1_OC2M_FORCE_HIGH         EQU (5<<12)
TIM_CCMR1_OC2M_PWM1               EQU (6<<12)
TIM_CCMR1_OC2M_PWM2               EQU (7<<12)
;15 out
TIM_CCMR1_OC2CE                   EQU (1<<15)


;12-15 input capture filter
TIM_CCMR1_IC2F_FDTS        EQU (0<<12) 
TIM_CCMR1_IC2F_FCK_INT_2   EQU (1<<12)
TIM_CCMR1_IC2F_FCK_INT_4   EQU (2<<12)
TIM_CCMR1_IC2F_FCK_INT_8   EQU (3<<12)
TIM_CCMR1_IC2F_FDTS_2_6    EQU (4<<12)
TIM_CCMR1_IC2F_FDTS_2_8    EQU (5<<12)
TIM_CCMR1_IC2F_FDTS_4_6    EQU (6<<12)
TIM_CCMR1_IC2F_FDTS_4_8    EQU (7<<12)
TIM_CCMR1_IC2F_FDTS_8_6    EQU (8<<12)
TIM_CCMR1_IC2F_FDTS_8_8    EQU (9<<12)
TIM_CCMR1_IC2F_FDTS_16_5   EQU (10<<12)
TIM_CCMR1_IC2F_FDTS_16_6   EQU (11<<12)
TIM_CCMR1_IC2F_FDTS_16_8   EQU (12<<12)
TIM_CCMR1_IC2F_FDTS_32_5   EQU (13<<12)
TIM_CCMR1_IC2F_FDTS_32_6   EQU (14<<12)
TIM_CCMR1_IC2F_FDTS_32_8   EQU (15<<12)


;0-1
TIM_CCMR2_CC3S_OUT             EQU (0<<0)               
TIM_CCMR2_CC3S_IN_TI3          EQU (1<<0)        
TIM_CCMR2_CC3S_IN_TI4          EQU (2<<0)        
TIM_CCMR2_CC3S_IN_TRC          EQU (3<<0)   



;2-3 out
TIM_CCMR2_OC3FE                   EQU TIM_CCMR1_OC1FE                 
TIM_CCMR2_OC3PE                   EQU TIM_CCMR1_OC1PE    

;2-3 input capture prescaler
TIM_CCMR2_IC3PSC_DIV1             EQU TIM_CCMR1_IC1PSC_DIV1
TIM_CCMR2_IC3PSC_DIV2             EQU TIM_CCMR1_IC1PSC_DIV2
TIM_CCMR2_IC3PSC_DIV4             EQU TIM_CCMR1_IC1PSC_DIV4
TIM_CCMR2_IC3PSC_DIV8             EQU TIM_CCMR1_IC1PSC_DIV8

;4-6 output
TIM_CCMR2_OC3M_FROZEN             EQU TIM_CCMR1_OC1M_FROZEN           
TIM_CCMR2_OC3M_ACTIVE_ON_MATCH    EQU TIM_CCMR1_OC1M_ACTIVE_ON_MATCH  
TIM_CCMR2_OC3M_INACTIVE_ON_MATCH  EQU TIM_CCMR1_OC1M_INACTIVE_ON_MATCH
TIM_CCMR2_OC3M_TOGGLE             EQU TIM_CCMR1_OC1M_TOGGLE           
TIM_CCMR2_OC3M_FORCE_LOW          EQU TIM_CCMR1_OC1M_FORCE_LOW        
TIM_CCMR2_OC3M_FORCE_HIGH         EQU TIM_CCMR1_OC1M_FORCE_HIGH       
TIM_CCMR2_OC3M_PWM1               EQU TIM_CCMR1_OC1M_PWM1             
TIM_CCMR2_OC3M_PWM2               EQU TIM_CCMR1_OC1M_PWM2             
;7  out
TIM_CCMR2_OC3CE                   EQU TIM_CCMR1_OC1CE                 

;4-7 input capture filter
TIM_CCMR2_IC3F_FDTS        EQU TIM_CCMR1_IC1F_FDTS     
TIM_CCMR2_IC3F_FCK_INT_2   EQU TIM_CCMR1_IC1F_FCK_INT_2
TIM_CCMR2_IC3F_FCK_INT_4   EQU TIM_CCMR1_IC1F_FCK_INT_4
TIM_CCMR2_IC3F_FCK_INT_8   EQU TIM_CCMR1_IC1F_FCK_INT_8
TIM_CCMR2_IC3F_FDTS_2_6    EQU TIM_CCMR1_IC1F_FDTS_2_6 
TIM_CCMR2_IC3F_FDTS_2_8    EQU TIM_CCMR1_IC1F_FDTS_2_8 
TIM_CCMR2_IC3F_FDTS_4_6    EQU TIM_CCMR1_IC1F_FDTS_4_6 
TIM_CCMR2_IC3F_FDTS_4_8    EQU TIM_CCMR1_IC1F_FDTS_4_8 
TIM_CCMR2_IC3F_FDTS_8_6    EQU TIM_CCMR1_IC1F_FDTS_8_6 
TIM_CCMR2_IC3F_FDTS_8_8    EQU TIM_CCMR1_IC1F_FDTS_8_8 
TIM_CCMR2_IC3F_FDTS_16_5   EQU TIM_CCMR1_IC1F_FDTS_16_5
TIM_CCMR2_IC3F_FDTS_16_6   EQU TIM_CCMR1_IC1F_FDTS_16_6
TIM_CCMR2_IC3F_FDTS_16_8   EQU TIM_CCMR1_IC1F_FDTS_16_8
TIM_CCMR2_IC3F_FDTS_32_5   EQU TIM_CCMR1_IC1F_FDTS_32_5
TIM_CCMR2_IC3F_FDTS_32_6   EQU TIM_CCMR1_IC1F_FDTS_32_6
TIM_CCMR2_IC3F_FDTS_32_8   EQU TIM_CCMR1_IC1F_FDTS_32_8

;8-9 in/out
TIM_CCMR2_CC4S_OUT             EQU (0<<8)               
TIM_CCMR2_CC4S_IN_TI4          EQU (1<<8)        
TIM_CCMR2_CC4S_IN_TI3          EQU (2<<8)        
TIM_CCMR2_CC4S_IN_TRC          EQU (3<<8)   

;10-11 out
TIM_CCMR2_OC4FE                   EQU TIM_CCMR1_OC2FE                 
TIM_CCMR2_OC4PE                   EQU TIM_CCMR1_OC2PE    

;10-11 input capture prescaler
TIM_CCMR2_IC4PSC_DIV1             EQU TIM_CCMR1_IC2PSC_DIV1
TIM_CCMR2_IC4PSC_DIV2             EQU TIM_CCMR1_IC2PSC_DIV2
TIM_CCMR2_IC4PSC_DIV4             EQU TIM_CCMR1_IC2PSC_DIV4
TIM_CCMR2_IC4PSC_DIV8             EQU TIM_CCMR1_IC2PSC_DIV8


;12-14 output
TIM_CCMR2_OC4M_FROZEN             EQU TIM_CCMR1_OC2M_FROZEN           
TIM_CCMR2_OC4M_ACTIVE_ON_MATCH    EQU TIM_CCMR1_OC2M_ACTIVE_ON_MATCH  
TIM_CCMR2_OC4M_INACTIVE_ON_MATCH  EQU TIM_CCMR1_OC2M_INACTIVE_ON_MATCH
TIM_CCMR2_OC4M_TOGGLE             EQU TIM_CCMR1_OC2M_TOGGLE           
TIM_CCMR2_OC4M_FORCE_LOW          EQU TIM_CCMR1_OC2M_FORCE_LOW        
TIM_CCMR2_OC4M_FORCE_HIGH         EQU TIM_CCMR1_OC2M_FORCE_HIGH       
TIM_CCMR2_OC4M_PWM1               EQU TIM_CCMR1_OC2M_PWM1             
TIM_CCMR2_OC4M_PWM2               EQU TIM_CCMR1_OC2M_PWM2             
;15 out
TIM_CCMR2_OC4CE                   EQU TIM_CCMR1_OC2CE                 


;12-15 input capture filter
TIM_CCMR2_IC4F_FDTS        EQU      TIM_CCMR1_IC2F_FDTS         
TIM_CCMR2_IC4F_FCK_INT_2   EQU      TIM_CCMR1_IC2F_FCK_INT_2 
TIM_CCMR2_IC4F_FCK_INT_4   EQU      TIM_CCMR1_IC2F_FCK_INT_4 
TIM_CCMR2_IC4F_FCK_INT_8   EQU      TIM_CCMR1_IC2F_FCK_INT_8 
TIM_CCMR2_IC4F_FDTS_2_6    EQU      TIM_CCMR1_IC2F_FDTS_2_6  
TIM_CCMR2_IC4F_FDTS_2_8    EQU      TIM_CCMR1_IC2F_FDTS_2_8  
TIM_CCMR2_IC4F_FDTS_4_6    EQU      TIM_CCMR1_IC2F_FDTS_4_6  
TIM_CCMR2_IC4F_FDTS_4_8    EQU      TIM_CCMR1_IC2F_FDTS_4_8  
TIM_CCMR2_IC4F_FDTS_8_6    EQU      TIM_CCMR1_IC2F_FDTS_8_6  
TIM_CCMR2_IC4F_FDTS_8_8    EQU      TIM_CCMR1_IC2F_FDTS_8_8  
TIM_CCMR2_IC4F_FDTS_16_5   EQU      TIM_CCMR1_IC2F_FDTS_16_5 
TIM_CCMR2_IC4F_FDTS_16_6   EQU      TIM_CCMR1_IC2F_FDTS_16_6 
TIM_CCMR2_IC4F_FDTS_16_8   EQU      TIM_CCMR1_IC2F_FDTS_16_8 
TIM_CCMR2_IC4F_FDTS_32_5   EQU      TIM_CCMR1_IC2F_FDTS_32_5 
TIM_CCMR2_IC4F_FDTS_32_6   EQU      TIM_CCMR1_IC2F_FDTS_32_6 
TIM_CCMR2_IC4F_FDTS_32_8   EQU      TIM_CCMR1_IC2F_FDTS_32_8 


TIM_CCER_CC1E  EQU (1<<0)
TIM_CCER_CC1P  EQU (1<<1)

    IF :DEF:STM32F4
TIM_CCER_CC1NP  EQU (1<<3)
    ENDIF

TIM_CCER_CC2E  EQU (1<<4)
TIM_CCER_CC2P  EQU (1<<5)
TIM_CCER_CC3E  EQU (1<<8)
TIM_CCER_CC3P  EQU (1<<9)
TIM_CCER_CC4E  EQU (1<<12)
TIM_CCER_CC4P  EQU (1<<13)


TIM_SMCR_SMS_OFF      EQU  0
TIM_SMCR_SMS_ENC1     EQU  1  
TIM_SMCR_SMS_ENC2     EQU  2  
TIM_SMCR_SMS_ENC3     EQU  3 
TIM_SMCR_SMS_RESET    EQU  4 
TIM_SMCR_SMS_GATED    EQU  5
TIM_SMCR_SMS_TRIGGER  EQU  6
TIM_SMCR_SMS_EXT      EQU  7
TIM_SMCR_SMS_CLEARMASK EQU 7
;100x
TIM_SMCR_OCCS        EQU (1<<3)

TIM_SMCR_TS_ITR0        EQU (0<<4)
TIM_SMCR_TS_ITR1        EQU (1<<4)
TIM_SMCR_TS_ITR2        EQU (2<<4)
TIM_SMCR_TS_ITR3        EQU (3<<4)
TIM_SMCR_TS_TI1F_ED     EQU (4<<4)
TIM_SMCR_TS_TI1FP1      EQU (5<<4)
TIM_SMCR_TS_TI1FP2      EQU (6<<4)
TIM_SMCR_TS_ETRF        EQU (7<<4)
TIM_SMCR_TS_CLEARMASK   EQU (7<<4)
TIM_SMCR_MSM            EQU (1<<7)


TIM_EGR_UG    EQU (1<<0)
TIM_EGR_CC1G  EQU (1<<1)
TIM_EGR_CC2G  EQU (1<<2)
TIM_EGR_CC3G  EQU (1<<3)
TIM_EGR_CC4G  EQU (1<<4)
TIM_EGR_TG    EQU (1<<6)

TIM_DCR_DBA_OFFSET  EQU 0
TIM_DCR_DBL_OFFSET  EQU 8

TIM_BDTR_MOE  EQU (1<<15)

    

TIM_INIT_SIZE EQU 6


    END